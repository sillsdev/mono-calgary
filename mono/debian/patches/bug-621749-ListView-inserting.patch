From 865970ce61516947872965be7f3f0abd981d93ac Mon Sep 17 00:00:00 2001
From: Quilt patch <unknown@unknown.com>
Date: Tue, 30 Aug 2011 16:56:35 +0200
Subject: [PATCH] bug-621749-ListView-inserting

FWNX-313 Flex configure column arrows inapproriately disabling
---
 .../System.Windows.Forms/ListView.cs               |    3 +++
 .../Test/System.Windows.Forms/ListViewEventTest.cs |   20 ++++++++++++++++++++
 2 files changed, 23 insertions(+), 0 deletions(-)

diff --git a/mcs/class/Managed.Windows.Forms/System.Windows.Forms/ListView.cs b/mcs/class/Managed.Windows.Forms/System.Windows.Forms/ListView.cs
index c1b7d79..2e28e46 100644
--- a/mcs/class/Managed.Windows.Forms/System.Windows.Forms/ListView.cs
+++ b/mcs/class/Managed.Windows.Forms/System.Windows.Forms/ListView.cs
@@ -5067,6 +5067,9 @@ namespace System.Windows.Forms
 				if (is_main_collection || value.ListView != null)
 					CollectionChanged (true);
 
+				if (value.Selected && owner != null)
+					owner.OnSelectedIndexChanged (EventArgs.Empty);
+
 				//UIA Framework event: Item Added
 				OnUIACollectionChangedEvent (new CollectionChangeEventArgs (CollectionChangeAction.Add, value));
 
diff --git a/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ListViewEventTest.cs b/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ListViewEventTest.cs
index 6ea048d..2a63012 100644
--- a/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ListViewEventTest.cs
+++ b/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ListViewEventTest.cs
@@ -371,5 +371,25 @@ namespace MonoTests.System.Windows.Forms
 
 			form.Close ();
 		}
+
+		[Test]
+		public void InsertSelectedItem ()
+		{
+			Form form = new Form ();
+			form.ShowInTaskbar = false;
+
+			var lvw = new ListView ();
+			lvw.SelectedIndexChanged += ListView_SelectedIndexChanged;
+			form.Controls.Add (lvw);
+			form.Show ();
+
+			var item = new ListViewItem ();
+			item.Selected = true;
+			Assert.AreEqual (0, selectedIndexChanged, "#A1");
+			lvw.Items.Insert (0, item);
+			Assert.AreEqual (1, selectedIndexChanged, "#A2");
+
+			form.Close ();
+		}
 	}
 }
-- 
1.7.4.1

