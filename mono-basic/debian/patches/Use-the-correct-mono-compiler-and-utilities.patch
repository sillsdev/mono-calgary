From 553530f7b253e0b9e3c914420fd5a3571cd4b126 Mon Sep 17 00:00:00 2001
From: Neil Mayhew <neil_mayhew@sil.org>
Date: Mon, 7 Nov 2011 12:34:44 -0700
Subject: [PATCH] Use the correct mono compiler and utilities

We want the ones from ${prefix}
---
 build/library.make              |    4 ++--
 build/rules.make                |    1 +
 configure                       |    1 +
 vbnc/cecil/Makefile             |    2 +-
 vbnc/cecil/symbols/mdb/Makefile |    2 +-
 vbnc/cecil/symbols/pdb/Makefile |    2 +-
 6 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/build/library.make b/build/library.make
index f1ea35c..84c1011 100644
--- a/build/library.make
+++ b/build/library.make
@@ -94,13 +94,13 @@ endif
 ifdef NO_INSTALL
 GACUTIL = :
 else
-GACUTIL = gacutil
+GACUTIL = ${mono_bindir}/gacutil
 endif
 
 ifdef NO_SIGN_ASSEMBLY
 SN = :
 else
-SN = sn
+SN = ${mono_bindir}/sn
 SNFLAGS = -q -R
 endif
 
diff --git a/build/rules.make b/build/rules.make
index 6a7b94b..abeeab4 100644
--- a/build/rules.make
+++ b/build/rules.make
@@ -23,6 +23,7 @@ CCOMPILE = $(CC) $(USE_CFLAGS)
 BOOTSTRAP_VBNC = MONO_PATH="$(topdir)/class/lib/bootstrap$(PLATFORM_PATH_SEPARATOR)$$MONO_PATH" $(RUNTIME) $(RUNTIME_FLAGS) --debug $(topdir)/class/lib/bootstrap/vbnc.exe
 BOOT_COMPILE = $(BOOTSTRAP_VBNC) $(USE_VBNC_FLAGS)
 VBNC = MONO_PATH="$(topdir)/class/lib/net_4_0$(PLATFORM_PATH_SEPARATOR)$$MONO_PATH" $(RUNTIME) $(RUNTIME_FLAGS) --debug $(topdir)/class/lib/net_4_0/vbnc.exe
+DMCS = ${mono_bindir}/dmcs
 INSTALL = $(SHELL) $(topdir)/install-sh
 INSTALL_DATA = $(INSTALL) -c -m 644
 INSTALL_BIN = $(INSTALL) -c -m 755
diff --git a/configure b/configure
index f48ba6e..4ed8549 100755
--- a/configure
+++ b/configure
@@ -29,6 +29,7 @@ done
 echo "prefix=$prefix" > build/config.make
 echo "exec_prefix=\${prefix}" >> build/config.make
 echo "mono_libdir=\${exec_prefix}/lib" >> build/config.make
+echo "mono_bindir=\${exec_prefix}/bin" >> build/config.make
 echo "man_dir=\${exec_prefix}/share/man" >> build/config.make
 echo "man1_dir=\${man_dir}/man1" >> build/config.make
 echo "MCS_FLAGS=-debug+" >> build/config.make
diff --git a/vbnc/cecil/Makefile b/vbnc/cecil/Makefile
index cf305a5..0b70d0d 100644
--- a/vbnc/cecil/Makefile
+++ b/vbnc/cecil/Makefile
@@ -4,7 +4,7 @@ SUBDIRS := symbols
 include ../../build/rules.make
 
 LIBRARY = Mono.Cecil.VB.dll
-LIBRARY_COMPILE = dmcs -keyfile:$(topdir)/$(thisdir)/mono.snk -d:CECIL -debug
+LIBRARY_COMPILE = $(DMCS) -keyfile:$(topdir)/$(thisdir)/mono.snk -d:CECIL -debug
 #LIBRARY_SNK = $(topdir)/$(thisdir)/mono.snk
 
 include ../../build/library.make
diff --git a/vbnc/cecil/symbols/mdb/Makefile b/vbnc/cecil/symbols/mdb/Makefile
index c29301c..a3bd797 100644
--- a/vbnc/cecil/symbols/mdb/Makefile
+++ b/vbnc/cecil/symbols/mdb/Makefile
@@ -4,7 +4,7 @@ SUBDIRS :=
 include ../../../../build/rules.make
 
 LIBRARY = Mono.Cecil.VB.Mdb.dll
-LIBRARY_COMPILE = dmcs -keyfile:$(topdir)/vbnc/cecil/mono.snk -r:$(topdir)/class/lib/$(PROFILE)/Mono.Cecil.VB.dll -d:CECIL -debug
+LIBRARY_COMPILE = $(DMCS) -keyfile:$(topdir)/vbnc/cecil/mono.snk -r:$(topdir)/class/lib/$(PROFILE)/Mono.Cecil.VB.dll -d:CECIL -debug
 BUILT_FILES = $(topdir)/class/lib/$(PROFILE)/Mono.Cecil.VB.dll
 
 include ../../../../build/library.make
diff --git a/vbnc/cecil/symbols/pdb/Makefile b/vbnc/cecil/symbols/pdb/Makefile
index 6aa7fae..0070e25 100644
--- a/vbnc/cecil/symbols/pdb/Makefile
+++ b/vbnc/cecil/symbols/pdb/Makefile
@@ -4,7 +4,7 @@ SUBDIRS :=
 include ../../../../build/rules.make
 
 LIBRARY = Mono.Cecil.VB.Pdb.dll
-LIBRARY_COMPILE = dmcs -keyfile:$(topdir)/vbnc/cecil/mono.snk -r:$(topdir)/class/lib/$(PROFILE)/Mono.Cecil.VB.dll -d:CECIL -debug
+LIBRARY_COMPILE = $(DMCS) -keyfile:$(topdir)/vbnc/cecil/mono.snk -r:$(topdir)/class/lib/$(PROFILE)/Mono.Cecil.VB.dll -d:CECIL -debug
 
 BUILT_FILES = $(topdir)/class/lib/$(PROFILE)/Mono.Cecil.VB.dll
 
-- 
1.7.7.1

